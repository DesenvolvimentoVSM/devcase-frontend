<div class="container">

  <div class="titulo center">
    Vendas
  </div>

  <div class="card">
    <h4 class="span">Buscar vendas por período</h4>
    <div class="center">
      <p-inputMask class="espaco" mask="99/99/9999" placeholder="Data de" size="20" [(ngModel)]="dataDe" name="dataDe"></p-inputMask>
      <p-inputMask mask="99/99/9999" placeholder="Data até" size="20" [(ngModel)]="dataAte" name="dataDe"></p-inputMask>
    </div>
    <br>
    <div class="center">
        <p-radioButton class="espaco" name="sexo" value="MASCULINO" label="Masculino" [(ngModel)]="sexo"></p-radioButton>
        <p-radioButton class="espaco" name="sexo" value="FEMININO" label="Feminino" [(ngModel)]="sexo"></p-radioButton>
        <button class="btn btn-outline-dark" type="button" (click)="limparCamposPesquisa()">Limpar Campos</button>
    </div>
    <br>
    
    <div class="center">
      <button type="button" class="btn btn-success" style="margin-bottom: 1%; padding-left: 10%; padding-right: 10%"
       (click)="listarVendasPorDataOuSexo()">
        <i class="fa fa-search"></i> Buscar</button>
    </div>
    
  </div>
  <br>

  <div class="row">
    <div class="col col-md-2">
      <button type="button" class="btn btn-success" style="margin-bottom: 5%" (click)="showDialogVenda()">
        <i class="fa fa-plus"></i> Registrar Venda</button>
    </div>
    <div>
      <a class="btn btn-danger" style="margin-bottom: 5%" routerLink="/menu">
        <i class="fa fa-arrow-circle-left"></i> Voltar</a>
    </div>
  </div>

  <div class="row col-md-12" style="margin-bottom: 5%;">
    <p-table #table [value]="vendas" [paginator]="true" [rows]="5" [responsive]="true" [globalFilterFields]="['cliente.nome']"
      [rowsPerPageOptions]="['5','15','20','30']">
      <ng-template pTemplate="caption">
        <div style="text-align: left">
          <i class="fa fa-search" style="margin:4px 4px 0 0"></i>
          <input type="text" pInputText size="25%" placeholder="Pesquisar por Cliente" (input)="table.filterGlobal($event.target.value, 'contains')"
            style="width:auto">
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr class="center">
          <th>Descrição</th>
          <th>Data</th>
          <th>Valor</th>
          <th>Cliente</th>
          <th>Pontos</th>
          <th>Tipo</th>
          <th>Ações</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-venda>
        <tr class="center">
          <td>{{venda.descricao}}</td>
          <td>{{venda.data | date: 'dd/MM/yyyy'}}</td>
          <td>{{venda.valor | currency:'BRL'}}</td>
          <td>{{venda.cliente.nome}}</td>
          <td class="pontos">{{venda.pontos.pontos}}</td>
          <td>{{venda.tipoPag.descricao}}</td>
          <td>
            <button class="btn btn-danger" pTooltip="Excluir" tooltipPosition="top" (click)="confirmarExclusao(venda.id)">
              <i class="fa fa-trash"></i></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- DIALOG PARA ALTERAR PONTUACAO -->
  <p-dialog [(visible)]="dialogVenda" header="Registrar Vendas" [modal]="true" [responsive]="true" [closable]="false"
    [style]="{width: '400px', minWidth: '350px'}">

    <form #form="ngForm">

      <div class="container">

        <div class="row">
          <h4>Informe os dados registrar uma Venda</h4>
        </div>
        <br>
        <div>
          <div class="col-12 col-md-12">
            <input type="text" placeholder="Descrição" pInputText size="40" [(ngModel)]="venda.descricao" name="descricao"
              required>
          </div>
        </div>
        <br>

        <div class="col-12 col-md-6">
          <p-dropdown [options]="clientes" [(ngModel)]="clienteSelecionado" name="cliente" optionLabel="nome" [filter]="true"
            filterBy="label,value.nome" placeholder="Cliente"></p-dropdown>
        </div>
        <br>

        <div class="col-12 col-md-6">
          <p-dropdown [options]="tiposPag" [(ngModel)]="tipoPagSelecionado" name="tipoPag" optionLabel="descricao"
            [filter]="true" filterBy="label,value.descricao" placeholder="Tipo Pagamento"></p-dropdown>
        </div>
        <br>

        <div class="col-12 col-md-6">
          <input currencyMask placeholder="Valor" pInputText [(ngModel)]="venda.valor" name="valor" [options]="{ prefix: 'R$ ', thousands: '.', decimal: ',' }"
            required>
        </div>
        <br>
        <br>

      </div>
    </form>

    <p-footer>
      <button type="button" class="btn btn-success" style="margin-right: 7px" [disabled]="form.invalid" (click)="cadastrarVenda()">
        <i class="fa fa-check"></i> Salvar</button>
      <button type="button" class="btn btn-danger" (click)="closeDialogVenda()" (click)="form.reset()">
        <i class="fa fa-times"></i> Cancelar</button>
    </p-footer>
  </p-dialog>

  <!--DIALOG DE CONFIRMAR EXCLUSAO-->
  <p-dialog [(visible)]="dialogConfirmarExclusao" header="Confirmar Exclusão" [modal]="true" [closable]="false"
    [responsive]="true">
    <br>
    <h4>Você deseja realmente excluir ?</h4>
    <br>
    <p-footer>
      <button type="button" style="margin-right: 15px" class="btn btn-success" (click)="excluirVenda()">
        <i class="fa fa-check-circle"></i> Sim</button>
      <button type="button" class="btn btn-danger" (click)="dialogConfirmarExclusao=false">
        <i class="fa fa-times-circle"></i> Não</button>
    </p-footer>
  </p-dialog>



</div>
